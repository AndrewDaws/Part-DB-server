language: php

services:
  - mysql

env:
  - SYMFONY_DEPRECATIONS_HELPER=disabled APP_ENV=test # Disable deprecation warnings

# Test for all supported PHP versions
php:
  - '7.1'
  - '7.2'
  - '7.3'
  - '7.4snapshot'
  - 'nightly'

install:
  - composer install
  - php bin/console --env test doctrine:database:create --if-not-exists -n
  - php bin/console --env test doctrine:migrations:migrate -n
  # Load fixtures (we have to truncate database by ourselves or we get foreing key valiation errors
  - php bin/console --env test doctrine:query:sql "SET foreign_key_checks = 0; TRUNCATE `groups`; TRUNCATE `users`;"
  - php bin/console --env test doctrine:fixtures:load -n

script:
  - php bin/phpunit

matrix:
  fast_finish: true
  allow_failures:
    - php: 7.4snapshot
    - php: nightly